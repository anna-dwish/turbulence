---
title: "Turbulence Case Study"
author: "Alexander Bendeck, Anna Darwish, Thea Dowrich, Ashley Murray, Matty Pahren"
date: "10/19/2020"
output: pdf_document
---

```{r, function checking for installed packages, echo=FALSE, results="hide", include=FALSE}
# Validate that all necessary packaged have been downloaded, install otherwise or throw err package DNE
pkgTest <- function(x)
{
  if (!require(x,character.only = TRUE))
  {
    install.packages(x,repos = "http://cran.r-project.org", dep=TRUE)
    if(!require(x,character.only = TRUE)) stop("Package not found")
  }
}
```

```{r Package Test Libraries, echo=FALSE, results="hide", include=FALSE}
pkgTest("dplyr")
pkgTest("ggplot2")
pkgTest("tidyr")
pkgTest("knitr")
pkgTest("kableExtra")
pkgTest("gridExtra")
pkgTest("pander")
pkgTest("tidyverse")
```

```{r Load in Libraries, echo=FALSE, results="hide", include=FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)
library(knitr)
library(kableExtra)
library(gridExtra)
library(pander)
library(tidyverse)
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE)
ggplot2::theme_set(new = theme_bw())
set.seed(123)
```

# Introduction

One of the greatest areas of research in Physics today is the study of fluid motion [cite]. The applications of these investigations span across the aviation industry, astrophysics, oil spills in oceans, and more [cite]. For this case study, we will be exploring models to better understand and predict turbulence, which is defined to be "chaotic changes in pressure and flow velocity" [cite]. 

Our covariates of concern in this study are *Reynolds number (Re)*, *Freud's Number (Fr)*, and *Particle characteristic (St)*. *Reynolds number* captures the ratio between fluid velocity and the body size of the object moving through the fluid. *Freud's Number* specifies the gravity conditions of the fluid, and *Particle characteristic* provides information on the size and density of the particles. We will be modeling these covariates' relationship with the first four raw moments of particle cluster volumes in an idealized turbulence (homogeneous isotropic turbulence).

For this case study, our research objectives are:

1. Understand and interpret the relationship between the first four moments of particle cluster volumes and *Reynolds number*, *Freud's Number*, and *Particle characteristic*.
2. Estimate the accuracy of our models

```{r Data Dictionary, echo=F}
data.dict <- data.frame(Variable = c(rep("Reynolds number (Re)", 1),
                                          rep("Freud's Number (Fr)", 1),
                                          rep("Particle characteristic (St)", 1),
                                          rep(" (Sv)", 1)),
                               Values = linebreak(c("90 (Low), 224 (Med), 398 (High)",
                                                    "0.052 (Low), 0.300 (Med), Inf (High)",
                                                    "[0.05, 3.00]",
                                                    "[0.00,57.692]")))
kable(data.dict, escape=F, booktabs = T, align = "ll", caption = "Data Dictionary") %>%
  kable_styling(latex_options = c("hold_position")) %>%
  column_spec(1, bold=T) %>%
  collapse_rows(columns = 1, latex_hline = "major", valign = "middle")
```

# Methodology

Prior studies on turbulence motivated us to consider the covariate, *Sr*, which is generated by dividing *Particle characteristic* with *Freud's Number*.

For each of our four models, we began by conducting exploratory data analysis with the predictors in our dataset. This informed our decisions for possible models, transformations, and interactions to explore. Given that one of our primary goals is to understand and interpret the relationship between *turbulence* and our predictors, we chose to use linear regression models but also explored polynomial and spline models to determine whether either provided significantly better predictive power. 

For the second, third, and fourth moment, we noticed a curved relationship between the response and covariates, which motivated us to perform a logged transformation on the response.

To compare different linear regression models for the same moment, we began by comparing adjusted *R^2* values, as it compensates for added predictors that do not significantly improve the amount of explained variance in the response. To compare any two models across the different methodologies we attempted, we performed 5-fold cross validation and compared the estimated test errors.

Finally, we examined residual and levereage plots for each of our four models to ensure we didn't violate any of the assumptions that accompany linear regression models.

# Discussion

## Moment 1

```{r Read in Data, echo=FALSE}
turbulence = read.csv("data-train.csv")

turbulence$Sv = turbulence$St / turbulence$Fr

turbulence$Re <- as.factor(turbulence$Re)
levels(turbulence$Re) <- c("Low", "Med", "High")

turbulence$Fr <- as.factor(turbulence$Fr)
levels(turbulence$Fr) <- c("Low", "Inf", "Med") 
```

```{r Moment 1 Model, fig.align="center", fig.width=6, fig.height =4}
moment.1.mod <- lm(R_moment_1 ~ Re + St + St*Re + Sv + Sv*Re, data=turbulence)
pander(moment.1.mod, caption="Moment 1")

par(mfrow = c(1, 2))
plot(moment.1.mod, which=c(1))
plot(moment.1.mod, which=c(5))
```

## Moment 2

```{r Moment 2 Model, fig.align="center", fig.width=8, fig.height =4}
moment.2.mod <- lm(log(R_moment_2) ~ Re + Fr + St + Re*Fr, data = turbulence)
pander(moment.2.mod, caption="Moment 3")

par(mfrow = c(1, 2))
plot(moment.2.mod, which=c(1))
plot(moment.2.mod, which=c(5))
```

## Moment 3

```{r Moment 3 Model, fig.align="center", fig.width=8, fig.height =4}
moment.3.mod <- lm(R_moment_3 ~ Re + Fr + St + Fr*St + Fr*Re + St*Re, data = turbulence)
pander(moment.3.mod, caption="Moment 3")

par(mfrow = c(1, 2))
plot(moment.3.mod, which=c(1))
plot(moment.3.mod, which=c(5))
```

## Moment 4

```{r Moment 4 Model, fig.align="center", fig.width=8, fig.height =4}
moment.4.mod <- lm(log(R_moment_4) ~ Re + Sv + Sv^2 + St + St^2 + Re*Sv + Re*St + Sv*St, data=turbulence)
pander(moment.4.mod, caption="Moment 4")

par(mfrow = c(1, 2))
plot(moment.4.mod, which=c(1))
plot(moment.4.mod, which=c(5))
```







